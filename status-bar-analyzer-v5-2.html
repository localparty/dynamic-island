<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status Bar Color Analyzer v5</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        h1 {
            color: white;
            text-align: center;
            font-size: 28px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .main-container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            align-items: flex-start;
        }

        .device-column {
            flex-shrink: 0;
        }

        .controls-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .controls {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
        }

        .value-display {
            text-align: right;
            color: #666;
            font-size: 14px;
            margin-top: 4px;
        }

        .toggle-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
        }

        .toggle-label {
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 26px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #667eea;
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .device-container {
            position: relative;
            width: 390px;
            height: 844px;
            border-radius: 40px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            background: #000;
        }

        .device-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .device-content iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }

        .status-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 44px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 15px;
            font-weight: 600;
            z-index: 100;
            transition: color 0.3s ease;
            pointer-events: none;
        }

        .status-bar.content-hidden > * {
            opacity: 0;
        }

        .status-bar > * {
            transition: opacity 0.2s;
        }

        .time {
            flex-shrink: 0;
        }

        .icons {
            display: flex;
            gap: 6px;
            align-items: center;
            flex-shrink: 0;
        }

        .analysis-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .analysis-section h2 {
            margin-bottom: 20px;
            color: #333;
            font-size: 20px;
        }

        .canvas-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .canvas-box {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background: #f9f9f9;
        }

        .canvas-box h3 {
            margin-bottom: 10px;
            color: #555;
            font-size: 14px;
            text-align: center;
            font-weight: 600;
        }

        .canvas-box canvas {
            width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            image-rendering: pixelated;
            display: block;
        }

        .debug-canvas-box {
            grid-column: 1 / -1;
            border: 2px solid #667eea;
            background: #f0f0ff;
        }

        .debug-canvas-box h3 {
            color: #667eea;
        }

        .debug-canvas-wrapper {
            position: relative;
            overflow: auto;
            max-height: 400px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .debug-canvas-wrapper canvas {
            display: block;
            transform-origin: top left;
        }

        .color-info {
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .color-info h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 16px;
        }

        .color-swatches {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .swatch {
            height: 50px;
            border-radius: 8px;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .debug-section {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #333;
        }

        .debug-section p {
            margin: 5px 0;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.active {
            background: #4caf50;
            box-shadow: 0 0 8px #4caf50;
        }

        .status-indicator.inactive {
            background: #ccc;
        }
    </style>
</head>
<body>
    <h1>ðŸ“± Status Bar Color Analyzer v5</h1>

    <div class="main-container">
        <div class="device-column">
            <div class="device-container">
                <div class="device-content">
                    <iframe id="appContent" srcdoc=""></iframe>
                </div>
                <div class="status-bar" id="statusBar">
                    <div class="time">9:41</div>
                    <div class="icons">
                        <span>ðŸ“¶</span>
                        <span>ðŸ“¡</span>
                        <span>ðŸ”‹</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls-column">
            <div class="controls">
                <div class="control-group">
                    <label for="opacity">Status Bar Opacity</label>
                    <input type="range" id="opacity" min="0" max="100" value="0" step="1">
                    <div class="value-display"><span id="opacityValue">0</span>%</div>
                </div>

                <div class="control-group">
                    <label for="samplingRate">Auto-Sampling Rate (Hz)</label>
                    <input type="range" id="samplingRate" min="0.1" max="10" value="1" step="0.1">
                    <div class="value-display"><span id="samplingRateValue">1.0</span> Hz (<span id="samplingIntervalValue">1000</span>ms)</div>
                </div>

                <div class="toggle-group">
                    <label class="toggle-label">Hide Status Content</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="hideContent" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="toggle-group">
                    <label class="toggle-label">
                        <span class="status-indicator" id="autoSampleIndicator"></span>
                        Auto-Sampling
                    </label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoSample" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <button onclick="analyzeColors()">ðŸ”¬ Analyze Once</button>
            </div>

            <div class="analysis-section" id="analysisSection" style="display: none;">
                <h2>ðŸ“Š Color Analysis Results</h2>
                
                <div class="canvas-container" id="canvasContainer">
                    <!-- Dynamically generated child canvases -->
                </div>

                <div class="color-info">
                    <h3>Detected Colors & Theme</h3>
                    <div class="color-swatches" id="colorSwatches">
                        <!-- Dynamically generated swatches -->
                    </div>
                    <div class="debug-section" id="debugInfo"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Generate iframe content with colorful sections and html2canvas injection
        function createIframeContent() {
            const doc = `<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        .section {
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .section:nth-child(1) { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .section:nth-child(2) { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .section:nth-child(3) { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .section:nth-child(4) { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .section:nth-child(5) { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .section:nth-child(6) { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
        .section:nth-child(7) { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .section:nth-child(8) { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .section:nth-child(9) { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .section:nth-child(10) { background: linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 100%); }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"><\/script>
</head>
<body>
    <div class="section">Section 1</div>
    <div class="section">Section 2</div>
    <div class="section">Section 3</div>
    <div class="section">Section 4</div>
    <div class="section">Section 5</div>
    <div class="section">Section 6</div>
    <div class="section">Section 7</div>
    <div class="section">Section 8</div>
    <div class="section">Section 9</div>
    <div class="section">Section 10</div>
    <script>
        window.addEventListener('message', async (event) => {
            if (event.data.action === 'takeScreenshot') {
                try {
                    console.log('[IFRAME] Taking screenshot...');
                    
                    // Create an overlay div that covers the viewport
                    const overlay = document.createElement('div');
                    overlay.id = 'screenshot-overlay';
                    overlay.style.position = 'fixed';
                    overlay.style.top = '0';
                    overlay.style.left = '0';
                    overlay.style.right = '0';
                    overlay.style.bottom = '0';
                    overlay.style.zIndex = '10000';
                    overlay.style.pointerEvents = 'none';
                    // Try with transparent background to see if it captures what's behind
                    overlay.style.backgroundColor = 'transparent';
                    
                    document.body.appendChild(overlay);
                    console.log('[IFRAME] Overlay created, screenshotting viewport overlay...');
                    
                    const canvas = await html2canvas(overlay, {
                        backgroundColor: null,
                        scale: 1,
                        logging: true,
                        useCORS: true,
                        allowTaint: true
                    });
                    
                    // Remove overlay after screenshot
                    document.body.removeChild(overlay);
                    console.log('[IFRAME] Overlay removed');
                    
                    const dataURL = canvas.toDataURL('image/png');
                    
                    console.log('[IFRAME] Screenshot complete, sending to parent');
                    parent.postMessage({
                        action: 'screenshotReady',
                        dataURL: dataURL,
                        width: canvas.width,
                        height: canvas.height
                    }, '*');
                } catch (error) {
                    console.error('[IFRAME] Screenshot error:', error);
                    // Clean up overlay if it exists
                    const overlay = document.getElementById('screenshot-overlay');
                    if (overlay) document.body.removeChild(overlay);
                    
                    parent.postMessage({
                        action: 'screenshotError',
                        error: error.message
                    }, '*');
                }
            }
        });
        
        window.addEventListener('load', () => {
            parent.postMessage({ action: 'iframeReady' }, '*');
            console.log('[IFRAME] Ready and listening for screenshot requests');
        });
    <\/script>
</body>
</html>`;
            return doc;
        }

        // Initialize iframe
        const iframe = document.getElementById('appContent');
        iframe.srcdoc = createIframeContent();

        const opacityInput = document.getElementById('opacity');
        const opacityValue = document.getElementById('opacityValue');
        const samplingRateInput = document.getElementById('samplingRate');
        const samplingRateValue = document.getElementById('samplingRateValue');
        const samplingIntervalValue = document.getElementById('samplingIntervalValue');
        const hideContentToggle = document.getElementById('hideContent');
        const autoSampleToggle = document.getElementById('autoSample');
        const autoSampleIndicator = document.getElementById('autoSampleIndicator');
        const statusBar = document.getElementById('statusBar');
        const analysisSection = document.getElementById('analysisSection');

        let autoSampleInterval = null;
        let currentSamplingRate = 1.0;

        const RECT_COLORS = [
            '#2196F3', // Blue for status bar
            '#f44336', // Red for child 0
            '#4CAF50', // Green for child 1
            '#FF9800', // Orange for child 2
            '#9C27B0', // Purple for child 3
            '#00BCD4', // Cyan for child 4
        ];

        // Update status bar opacity
        opacityInput.addEventListener('input', (e) => {
            const value = e.target.value;
            opacityValue.textContent = value;
            const opacity = value / 100;
            statusBar.style.backgroundColor = `rgba(0, 0, 0, ${opacity})`;
        });

        // Update sampling rate
        samplingRateInput.addEventListener('input', (e) => {
            const rate = parseFloat(e.target.value);
            currentSamplingRate = rate;
            samplingRateValue.textContent = rate.toFixed(1);
            const interval = Math.round(1000 / rate);
            samplingIntervalValue.textContent = interval;
            
            // Restart auto-sampling with new rate if it's active
            if (autoSampleToggle.checked) {
                stopAutoSampling();
                startAutoSampling();
            }
        });

        // Auto-sampling toggle
        autoSampleToggle.addEventListener('change', (e) => {
            if (e.target.checked) {
                startAutoSampling();
            } else {
                stopAutoSampling();
            }
        });

        function startAutoSampling() {
            const interval = Math.round(1000 / currentSamplingRate);
            autoSampleInterval = setInterval(() => {
                analyzeColors();
            }, interval);
            autoSampleIndicator.classList.add('active');
            autoSampleIndicator.classList.remove('inactive');
        }

        function stopAutoSampling() {
            if (autoSampleInterval) {
                clearInterval(autoSampleInterval);
                autoSampleInterval = null;
            }
            autoSampleIndicator.classList.remove('active');
            autoSampleIndicator.classList.add('inactive');
        }

        // Initialize auto-sampling
        if (autoSampleToggle.checked) {
            startAutoSampling();
        } else {
            autoSampleIndicator.classList.add('inactive');
        }

        async function analyzeColors() {
            const shouldHideContent = hideContentToggle.checked;
            
            // Temporarily hide content if toggle is on
            if (shouldHideContent) {
                statusBar.classList.add('content-hidden');
            }
            
            // Wait a frame for the hide to take effect
            await new Promise(resolve => setTimeout(resolve, 10));

            try {
                console.log('[PARENT] Requesting screenshot from iframe...');
                
                // Request screenshot from iframe
                const iframe = document.getElementById('appContent');
                
                // Set up a promise to wait for the iframe response
                const screenshotPromise = new Promise((resolve, reject) => {
                    const timeout = setTimeout(() => {
                        reject(new Error('Screenshot timeout'));
                    }, 5000);
                    
                    const messageHandler = (event) => {
                        if (event.data.action === 'screenshotReady') {
                            clearTimeout(timeout);
                            window.removeEventListener('message', messageHandler);
                            resolve(event.data);
                        } else if (event.data.action === 'screenshotError') {
                            clearTimeout(timeout);
                            window.removeEventListener('message', messageHandler);
                            reject(new Error(event.data.error));
                        }
                    };
                    
                    window.addEventListener('message', messageHandler);
                });
                
                // Send request to iframe
                iframe.contentWindow.postMessage({ action: 'takeScreenshot' }, '*');
                
                // Wait for response
                const screenshotData = await screenshotPromise;
                console.log('[PARENT] Screenshot received from iframe');
                
                // Restore content if it was hidden
                if (shouldHideContent) {
                    statusBar.classList.remove('content-hidden');
                }

                // Create canvas from data URL
                const img = new Image();
                await new Promise((resolve, reject) => {
                    img.onload = resolve;
                    img.onerror = reject;
                    img.src = screenshotData.dataURL;
                });
                
                const canvas = document.createElement('canvas');
                canvas.width = screenshotData.width;
                canvas.height = screenshotData.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);

                // Get bounding rectangles for status bar children
                // IMPORTANT: These coordinates are relative to the iframe's viewport
                const statusBarChildren = Array.from(statusBar.children);
                
                // Get the device container and iframe to calculate relative positions
                const deviceContainer = document.querySelector('.device-container');
                const deviceRect = deviceContainer.getBoundingClientRect();
                const iframeRect = iframe.getBoundingClientRect();
                
                // Clear previous canvases
                const canvasContainer = document.getElementById('canvasContainer');
                canvasContainer.innerHTML = '';

                const colorSwatches = document.getElementById('colorSwatches');
                colorSwatches.innerHTML = '';

                const childResults = [];

                // Process each child
                statusBarChildren.forEach((child, index) => {
                    const childRect = child.getBoundingClientRect();
                    
                    // Calculate position relative to iframe
                    // Status bar is at top:0 of device, iframe is also at top:0 of device
                    // So we can use the child's position directly
                    const relativeX = childRect.left - iframeRect.left;
                    const relativeY = childRect.top - iframeRect.top;
                    
                    // Create canvas for this child
                    const canvasBox = document.createElement('div');
                    canvasBox.className = 'canvas-box';
                    
                    const heading = document.createElement('h3');
                    heading.textContent = `Child ${index}`;
                    
                    const childCanvas = document.createElement('canvas');
                    childCanvas.width = childRect.width;
                    childCanvas.height = childRect.height;
                    
                    canvasBox.appendChild(heading);
                    canvasBox.appendChild(childCanvas);
                    canvasContainer.appendChild(canvasBox);

                    // Extract and draw region from iframe screenshot
                    const childCtx = childCanvas.getContext('2d');
                    childCtx.drawImage(
                        canvas,
                        relativeX, relativeY, childRect.width, childRect.height,
                        0, 0, childRect.width, childRect.height
                    );

                    // Analyze color
                    const color = getAverageColor(childCtx, childRect.width, childRect.height);
                    const brightness = getBrightness(color);
                    const theme = brightness > 128 ? 'dark' : 'light';

                    childResults.push({
                        index,
                        rect: childRect,
                        relativeX,
                        relativeY,
                        color,
                        brightness,
                        theme
                    });

                    // Create swatch
                    const swatch = document.createElement('div');
                    swatch.className = 'swatch';
                    swatch.style.backgroundColor = color.rgb;
                    swatch.textContent = `Child ${index}: ${color.rgb} (${theme} text)`;
                    swatch.style.color = theme === 'dark' ? '#ffffff' : '#000000';
                    colorSwatches.appendChild(swatch);
                });

                // Create debug canvas showing full iframe capture with rectangles
                const debugCanvasBox = document.createElement('div');
                debugCanvasBox.className = 'canvas-box debug-canvas-box';
                
                const debugHeading = document.createElement('h3');
                debugHeading.textContent = 'Full Iframe Capture Debug View (with coordinate rectangles)';
                
                const debugCanvasWrapper = document.createElement('div');
                debugCanvasWrapper.className = 'debug-canvas-wrapper';
                
                const debugCanvas = document.createElement('canvas');
                debugCanvas.width = canvas.width;
                debugCanvas.height = canvas.height;
                
                const debugCtx = debugCanvas.getContext('2d');
                debugCtx.drawImage(canvas, 0, 0);

                // Draw rectangles on debug canvas
                // Status bar container
                const statusBarRect = statusBar.getBoundingClientRect();
                const statusBarRelativeX = statusBarRect.left - iframeRect.left;
                const statusBarRelativeY = statusBarRect.top - iframeRect.top;
                
                debugCtx.strokeStyle = RECT_COLORS[0];
                debugCtx.lineWidth = 3;
                debugCtx.setLineDash([10, 5]);
                debugCtx.strokeRect(
                    statusBarRelativeX,
                    statusBarRelativeY,
                    statusBarRect.width,
                    statusBarRect.height
                );

                // Each child
                childResults.forEach((result, index) => {
                    debugCtx.strokeStyle = RECT_COLORS[index + 1] || RECT_COLORS[RECT_COLORS.length - 1];
                    debugCtx.lineWidth = 2;
                    debugCtx.setLineDash([8, 4]);
                    debugCtx.strokeRect(
                        result.relativeX,
                        result.relativeY,
                        result.rect.width,
                        result.rect.height
                    );
                });

                // Calculate scale to fit
                const targetWidth = 600;
                const scale = targetWidth / debugCanvas.width;
                debugCanvas.style.transform = `scale(${scale})`;
                debugCanvas.style.width = `${debugCanvas.width}px`;
                debugCanvas.style.height = `${debugCanvas.height}px`;
                
                debugCanvasWrapper.appendChild(debugCanvas);
                debugCanvasBox.appendChild(debugHeading);
                debugCanvasBox.appendChild(debugCanvasWrapper);
                canvasContainer.appendChild(debugCanvasBox);

                // Determine overall theme
                const darkBackgrounds = childResults.filter(r => r.brightness < 128).length;
                const shouldUseLightText = darkBackgrounds > 0;
                statusBar.style.color = shouldUseLightText ? '#ffffff' : '#000000';

                // Update debug info
                const debugInfo = document.getElementById('debugInfo');
                let debugHTML = `
                    <p><strong>Screenshot Source:</strong> Iframe (injected html2canvas)</p>
                    <p><strong>Iframe Canvas:</strong> ${canvas.width}w Ã— ${canvas.height}h</p>
                    <p><strong>Status Bar:</strong> ${statusBarRect.width.toFixed(0)}w Ã— ${statusBarRect.height.toFixed(0)}h at iframe (${statusBarRelativeX.toFixed(0)}, ${statusBarRelativeY.toFixed(0)})</p>
                    <p><strong>Children Count:</strong> ${statusBarChildren.length}</p>
                `;
                
                childResults.forEach(result => {
                    debugHTML += `<p><strong>Child ${result.index}:</strong> ${result.rect.width.toFixed(0)}w Ã— ${result.rect.height.toFixed(0)}h at (${result.relativeX.toFixed(0)}, ${result.relativeY.toFixed(0)}), brightness: ${result.brightness.toFixed(0)}</p>`;
                });

                debugHTML += `
                    <p><strong>Content Hidden:</strong> ${shouldHideContent ? 'Yes' : 'No'}</p>
                    <p><strong>Applied Theme:</strong> ${shouldUseLightText ? 'Light text (white)' : 'Dark text (black)'}</p>
                    <p><strong>Sampling Rate:</strong> ${currentSamplingRate.toFixed(1)} Hz</p>
                    <p><strong>Debug Canvas Scale:</strong> ${(scale * 100).toFixed(1)}%</p>
                `;

                debugInfo.innerHTML = debugHTML;

                // Show analysis section
                analysisSection.style.display = 'block';

            } catch (error) {
                console.error('[PARENT] Analysis error:', error);
                alert('Error analyzing colors: ' + error.message);
                
                // Make sure to restore content even on error
                if (shouldHideContent) {
                    statusBar.classList.remove('content-hidden');
                }
            }
        }

        function getAverageColor(ctx, width, height) {
            const imageData = ctx.getImageData(0, 0, width, height);
            const data = imageData.data;
            let r = 0, g = 0, b = 0, count = 0;

            for (let i = 0; i < data.length; i += 4) {
                r += data[i];
                g += data[i + 1];
                b += data[i + 2];
                count++;
            }

            r = Math.round(r / count);
            g = Math.round(g / count);
            b = Math.round(b / count);

            return {
                rgb: `rgb(${r}, ${g}, ${b})`,
                r, g, b
            };
        }

        function getBrightness(color) {
            // Calculate perceived brightness using luminance formula
            return (color.r * 0.299 + color.g * 0.587 + color.b * 0.114);
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>
</html>
